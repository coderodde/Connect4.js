<!DOCTYPE html>
<html>
    <head>
        <title>AI vs. AI playing Connect 4</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel='stylesheet' type="text/css" href='css/connect4.css' />
    </head>
    <body>
        <form>
            <div class="paramDivs">
            <h3>X engine parameters</h3>
            <h5>Search algorithm for X (beginning) AI:</h5>
            
            <table>
                <tr><td> <label for="xEngineAlphaBeta">Alpha-beta pruning              </label> </td><td> <input checked type="radio" name="xEngine" id="xEngineAlphaBeta" value="Alpha-beta"></td></tr>
                <tr><td> <label for="xEngineNegamax">  Negamax                         </label> </td><td> <input         type="radio" name="xEngine" id="xEngineNegamax"   value="Negamax">   </td></tr>
                <tr><td> <label for="xEnginePVS">      PVS (Principal Variation Search)</label> </td><td> <input         type="radio" name="xEngine" id="xEnginePVS"       value="PVS">       </td></tr>
            </table>
            
            <h5> Search depth for X AI:</h5>
            
            <table>
                <tr><td> <label for="xEngineDepth1" >1 </label> </td> <td> <input type="radio" name="xEngineDepth" id="xEngineDepth1"  value="1">         </td> </tr>
                <tr><td> <label for="xEngineDepth2" >2 </label> </td> <td> <input type="radio" name="xEngineDepth" id="xEngineDepth2"  value="2">         </td> </tr>
                <tr><td> <label for="xEngineDepth3" >3 </label> </td> <td> <input type="radio" name="xEngineDepth" id="xEngineDepth3"  value="3">         </td> </tr>
                <tr><td> <label for="xEngineDepth4" >4 </label> </td> <td> <input type="radio" name="xEngineDepth" id="xEngineDepth4"  value="4">         </td> </tr>
                <tr><td> <label for="xEngineDepth5" >5 </label> </td> <td> <input type="radio" name="xEngineDepth" id="xEngineDepth5"  value="5">         </td> </tr>
                <tr><td> <label for="xEngineDepth6" >6 </label> </td> <td> <input type="radio" name="xEngineDepth" id="xEngineDepth6"  value="6">         </td> </tr>
                <tr><td> <label for="xEngineDepth7" >7 </label> </td> <td> <input type="radio" name="xEngineDepth" id="xEngineDepth7"  value="7">         </td> </tr>
                <tr><td> <label for="xEngineDepth8" >8 </label> </td> <td> <input type="radio" name="xEngineDepth" id="xEngineDepth8"  value="8" checked> </td> </tr>
                <tr><td> <label for="xEngineDepth9" >9 </label> </td> <td> <input type="radio" name="xEngineDepth" id="xEngineDepth9"  value="9">          </td> </tr>
                <tr><td> <label for="xEngineDepth10">10</label> </td> <td> <input type="radio" name="xEngineDepth" id="xEngineDepth10" value="10">         </td> </tr>
            </table>
            </div>
            
            <div class="paramDivs">
            <h3>O engine parameters</h3>
            <h5>Search algorithm for O (following) AI:</h5>
            
            <table>
                <tr><td> <label for="oEngineAlphaBeta">Alpha-beta pruning              </label> </td><td> <input checked type="radio" name="oEngine" id="oEngineAlphaBeta" value="Alpha-beta"></td></tr>
                <tr><td> <label for="oEngineNegamax">  Negamax                         </label> </td><td> <input         type="radio" name="oEngine" id="oEngineNegamax"   value="Negamax">    </td></tr>
                <tr><td> <label for="oEnginePVS">      PVS (Principal Variation Search)</label> </td><td> <input         type="radio" name="oEngine" id="oEnginePVS"       value="PVS">        </td></tr>
            </table>
            
            <h5> Search depth for X AI:</h5>
            
            <table>
                <tr><td> <label for="oEngineDepth1" >1 </label> </td> <td> <input type="radio" name="oEngineDepth" id="oEngineDepth1"  value="1">         </td> </tr>
                <tr><td> <label for="oEngineDepth2" >2 </label> </td> <td> <input type="radio" name="oEngineDepth" id="oEngineDepth2"  value="2">         </td> </tr>
                <tr><td> <label for="oEngineDepth3" >3 </label> </td> <td> <input type="radio" name="oEngineDepth" id="oEngineDepth3"  value="3">         </td> </tr>
                <tr><td> <label for="oEngineDepth4" >4 </label> </td> <td> <input type="radio" name="oEngineDepth" id="oEngineDepth4"  value="4">         </td> </tr>
                <tr><td> <label for="oEngineDepth5" >5 </label> </td> <td> <input type="radio" name="oEngineDepth" id="oEngineDepth5"  value="5">         </td> </tr>
                <tr><td> <label for="oEngineDepth6" >6 </label> </td> <td> <input type="radio" name="oEngineDepth" id="oEngineDepth6"  value="6">         </td> </tr>
                <tr><td> <label for="oEngineDepth7" >7 </label> </td> <td> <input type="radio" name="oEngineDepth" id="oEngineDepth7"  value="7">         </td> </tr>
                <tr><td> <label for="oEngineDepth8" >8 </label> </td> <td> <input type="radio" name="oEngineDepth" id="oEngineDepth8"  value="8" checked> </td> </tr>
                <tr><td> <label for="oEngineDepth9" >9 </label> </td> <td> <input type="radio" name="oEngineDepth" id="oEngineDepth9"  value="9">         </td> </tr>
                <tr><td> <label for="oEngineDepth10">10</label> </td> <td> <input type="radio" name="oEngineDepth" id="oEngineDepth10" value="10">        </td> </tr>
            </table>
            </div>
            
        </form>
        
        <button onclick="runMatch();">RUN MATCH!</button>
        
        <div id='output-text-div'></div>
        <script src='js/connect4ai.js'></script>
        <script>
            
            const heuristicFunction = new ConnectFourHeuristicFunction();
            const alphaBetaPruningSearchEngine = new ConnectFourAlphaBetaPruningSearchEngine(heuristicFunction);
            const negamaxSearchEngine = new ConnectFourNegamaxSearchEngine(heuristicFunction);
            const pvsSearchEngine = new ConnectFourPrincipalVariationSearchEngine(heuristicFunction);
            
            let xEngine;
            let oEngine;
            let xDepth;
            let yDepth;
            
            function nameToEngine(name) {
                switch (name) {
                    case "Alpha-beta":
                        return alphaBetaPruningSearchEngine;
                        
                    case "Negamax":
                        return negamaxSearchEngine;
                        
                    case "PVS":
                        return pvsSearchEngine;
                        
                    default:
                        throw "Should not get here.";
                }
            }
            
            function getXEngine() {
                const radio = document.querySelector("input[name='xEngine']:checked");
                return nameToEngine(radio.value);
            }
            
            function getOEngine() {
                const radio = document.querySelector("input[name='oEngine']:checked");
                return nameToEngine(radio.value);
            }
            
            function depthNameToInteger(name) {
                return Number(name);
            }
            
            function getXDepth() {
                const radio = document.querySelector("input[name='xEngineDepth']:checked");
                return depthNameToInteger(radio.value);
            }
            
            function getODepth() {
                const radio = document.querySelector("input[name='oEngineDepth']:checked");
                return depthNameToInteger(radio.value);
            }
            
            function runMatch() {
                xEngine = getXEngine();
                oEngine = getOEngine();
                xDepth = getXDepth();
                oDepth = getODepth();
                gameLoop();
            }

            function flipTurn(playerTurn) {
                switch (playerTurn) {
                    case X:
                        return O;
                        
                    case O:
                        return X;
                        
                    default:
                        throw "Should not get here.";
                }
            }

            const output = document.getElementById('output-text-div');
            
            let turnNumber = 1;
            
            function getTurnNumberString() {
                if (turnNumber % 10 === 1) {
                    return turnNumber + "st";
                }
                
                if (turnNumber % 10 === 2) {
                    return turnNumber + "nd";
                }
                
                if (turnNumber % 10 === 3) {
                    return turnNumber + "rd";
                }
                
                return turnNumber + "th";
            }

            let engine = engineX;
            let state = new ConnectFourBoard();
            output.innerHTML += state.toString() + "<br/>";

            function millis() {
                return new Date().valueOf();
            }
            
            let totalDurationX = 0;
            let totalDurationO = 0;
            
            let turn = X;
            
            function getEngineName(engine) {
                let str = "";
                
                switch (engine) {
                    case alphaBetaPruningSearchEngine:
                        str += "Alpha-beta pruning engine";
                        break;
                        
                    case negamaxSearchEngine:
                        str += "Negamax engine";
                        break;
                        
                    case pvsSearchEngine:
                        str += "PVS engine";
                        break;
                        
                    default:
                        throw "Should not get here.";
                }
                
                if (engine === engineX) {
                    return str + " (X)";
                } else if (engine === engineO) {
                    return str + " (O)";
                } else {
                    throw "Should not get here.";
                }
            }
            
            function gameLoop() {
                setTimeout(() => {
                    let ta = millis();
                    state = engine.search(state, depth, turn);
                    let tb = millis();
                    
                    if (turn === X) {
                        totalDurationX += tb - ta;
                    } else {
                        totalDurationO += tb - ta;
                    }
                    
                    output.innerHTML += state.toString();
                    output.innerHTML += "<br/>";
                    output.innerHTML += 
                            turn === X ? 
                                getEngineName(engine)
                                        + " made the "
                                        + getTurnNumberString()
                                        + " turn, duration: " 
                                        + (tb - ta) 
                                        + " milliseconds.<br/>"
                                :
                                getEngineName(engine) 
                                        + " made the "
                                        + getTurnNumberString()
                                        + " turn, duration: " 
                                        + (tb - ta) 
                                        + " milliseconds.<br/>";
                                
                    turnNumber++;
                                
                    if (state.isTie()) {
                        output.innerHTML += "RESULT: It's a tie.<br/>";
                        return;
                    }
                    
                    if (turn === X) {
                        if (state.isWinningFor(X)) {
                            output.innerHTML += "RESULT: X won.<br/>";
                            output.innerHTML += "X AI total duration: " + totalDurationX + " milliseconds.<br/>";
                            output.innerHTML += "O AI total duration: " + totalDurationO + " milliseconds.<br/>";
                            window.scrollTo(0, document.body.scrollHeight);
                            return;
                        }
                    } else {
                        if (state.isWinningFor(O)) {
                            output.innerHTML += "RESULT: O won.<br/>";
                            output.innerHTML += "X AI total duration: " + totalDurationX + " milliseconds.<br/>";
                            output.innerHTML += "O AI total duration: " + totalDurationO + " milliseconds.<br/>";
                            window.scrollTo(0, document.body.scrollHeight);
                            return;
                        }
                    }
                    
                    function flipEngine(engine) {
                        if (engine === engineX) {
                            return engineO;
                        }
                        
                        if (engine === engineO) {
                            return engineX;
                        }
                        
                        throw "Should not get here.";
                    }
                    
                    turn = flipTurn(turn);
                    engine = flipEngine(engine);
                    
                    if (!state.isTerminal()) {
                        // Run the next frame:
                        window.scrollTo(0, document.body.scrollHeight);
                        requestAnimationFrame(gameLoop);
                    } else {
                    }
                }, 0);
            }
            
//            gameLoop();
        </script>
    </body>
</html>
